!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):"object"==typeof exports?exports.Slalom=i():t.Slalom=i()}(this,function(){return function(t){function i(e){if(n[e])return n[e].exports;var o=n[e]={exports:{},id:e,loaded:!1};return t[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}var n={};return i.m=t,i.c=n,i.p="",i(0)}([function(t,i,n){"use strict";var e={MotionContext:n(4),Manipulator:n(2),MotionConstraint:n(3),Box:n(1),Serialization:n(6)};t.exports=e},function(t){"use strict";function i(t){return Math.round(t*e)/e}function n(t){t&&t.style?this._element=t:(this._element=document.createElement("div"),this._element.className="box",t&&(this._element.textContent=t)),this.x=0,this.y=0,this.right=100,this.bottom=100,this.domWidth=-1,this.domHeight=-1,this._children=[],this.update()}var e=window.devicePixelRatio;n.prototype.element=function(){return this._element},n.prototype.addChild=function(t){this._children.push(t)},n.prototype.update=function(t,n){function e(t){return t.valueOf?t.valueOf():t}for(var o=e(this.x),a=e(this.y),s=e(this.right),r=e(this.bottom),h=Math.max(0,s-o),l=Math.max(0,r-a),c=0;c<this._children.length;c++)this._children[c].update(o,a);t||(t=0),n||(n=0),o-=t,a-=n;var u=1,_=1;if(-1!=this.domWidth&&(u=h/this.domWidth,h=this.domWidth),-1!=this.domHeight&&(_=l/this.domHeight,l=this.domHeight),1==u&&1==_&&(o=i(o),a=i(a),h=i(h),l=i(l)),h!=this._lastWidth&&(this._lastWidth=h,this._element.style.width=h+"px"),l!=this._lastHeight&&(this._lastHeight=l,this._element.style.height=l+"px"),o!=this._lastX||a!=this._lastY){this._lastX=o,this._lastY=a;var d="translate3D("+o+"px, "+a+"px, 0)";(1!=u||1!=_)&&(d+=" scale("+u+", "+_+")"),this._element.style.webkitTransform=d,this._element.style.transform=d}},t.exports=n},function(t){"use strict";function i(t,i){this._variable=t,this._solver=null,this._axis=i,this._context=null,this._motion=null,this._animation=null,this._name="manipulator-"+t.name+"-"+ ++n,this._hitConstraint=null,this._constraintCoefficient=1,this._motionState={editing:!1,dragging:!1,dragStart:0,dragDelta:0,dragTriggerDelta:0,velocityAnimation:null,velocityAnimationPosition:0,velocityAnimationVelocity:0,constraintAnimation:null,constraintAnimationPosition:0,constraintAnimationVelocity:0,constraintAnimationConstraint:null,trialAnimation:!1}}var n=0;i.prototype.onPan=function(t){if("panstart"==t.type){var i="x"==this._axis?t.deltaX:t.deltaY;this._motionContext.stopOthers(this._variable),this._motionState.dragging=!0,this._motionState.dragStart=this._variable.valueOf(),this._motionState.dragDelta=0,this._motionState.dragTriggerDelta=i,this._update()}else if("panmove"==t.type){var i="x"==this._axis?t.deltaX:t.deltaY;this._motionState.dragDelta=i-this._motionState.dragTriggerDelta,this._update()}else if("panend"==t.type){var n=1e3*-("x"==this._axis?t.velocityX:t.velocityY);this._motionState.dragging=!1,this._motionState.trialAnimation=!0,this._motionContext&&this._motionContext.update(),this._createAnimation(n),this._motionState.trialAnimation=!1}},i.prototype._setMotionContext=function(t){this._motionContext=t,this._solver=t.solver(),this._solver.add(new c.StayConstraint(this._variable,c.Strength.medium,0))},i.prototype.name=function(){return this._name},i.prototype.variable=function(){return this._variable},i.prototype.createMotion=function(t,i){var n=new Gravitas.Friction(.001);return n.set(t,i),n},i.prototype._cancelAnimation=function(t){this._motionState[t]&&(this._motionState[t].cancel(),this._motionState[t]=null)},i.prototype._update=function(){function t(){i._motionState.editing||(i._solver.beginEdit(i._variable,c.Strength.strong),i._motionState.editing=!0)}var i=this;if(this._motionState.dragging){this._cancelAnimation("velocityAnimation"),this._cancelAnimation("constraintAnimation"),this._motionState.velocityAnimationVelocity=0,this._motionState.constraintAnimationVelocity=0,t();var n=this._motionState.dragStart+this._motionState.dragDelta;if(this._hitConstraint){this._solver.suggestValue(this._variable,n);var e=this._hitConstraint.delta()/this._constraintCoefficient;n+=e*this._hitConstraint.overdragCoefficient}this._solver.suggestValue(this._variable,n)}else if(this._motionState.constraintAnimation){this._cancelAnimation("velocityAnimation"),t();var n=this._motionState.constraintAnimationPosition;if(this._solver.suggestValue(this._variable,n),!this._motionState.constraintAnimationConstraint.captive&&0==this._motionState.constraintAnimationConstraint.delta()){var o=this._motionState.constraintAnimationVelocity;this._createAnimation(o)}}else if(this._motionState.velocityAnimation){t();var n=this._motionState.velocityAnimationPosition;this._solver.suggestValue(this._variable,n)}else{if(!this._motionState.editing)return;this._solver.endEdit(this._variable),this._motionState.editing=!1,this._motionState.velocityAnimationVelocity=0,this._motionState.constraintAnimationVelocity=0}this._motionContext&&this._motionContext.update()},i.prototype._createAnimation=function(t){if(!this._motionState.dragging){var i=this;if(this._hitConstraint){if(this._motionState.constraintAnimation){if(this._motionState.constraintAnimationConstraint==this._hitConstraint||this._motionState.constraintAnimationConstraint.captive)return;this._cancelAnimation("constraintAnimation")}this._motionState.constraintAnimationConstraint=this._hitConstraint,t=i._motionState.velocityAnimation?i._motionState.velocityAnimationVelocity:t;var n=this._variable.valueOf();if(i._motionState.velocityAnimation)n=i._motionState.velocityAnimation.model.x(60);else if(t){var e=this.createMotion(this._variable.valueOf(),t);n=e.x(60)}var o=this._motionState.dragStart;if(this._variable!=this._hitConstraint.variable){var a=this._variable.valueOf();this._motionState.editing?(this._solver.suggestValue(this._variable,o),this._solver.solve(),o=this._hitConstraint.variable.valueOf(),this._solver.suggestValue(this._variable,n),this._solver.solve(),n=this._hitConstraint.variable.valueOf(),this._solver.suggestValue(this._variable,a),this._solver.solve()):console.warn("not editing; cannot figure out correct start/end positions for motion constraint")}var s=this._hitConstraint.delta(n,o),r=s/this._constraintCoefficient;this._cancelAnimation("constraintAnimation"),this._cancelAnimation("velocityAnimation");var e=this._hitConstraint.createMotion(this._variable.valueOf());return e.setEnd(this._variable.valueOf()+r,t),void(this._motionState.constraintAnimation=Gravitas.createAnimation(e,function(){i._motionState.constraintAnimationPosition=e.x(),i._motionState.constraintAnimationVelocity=e.dx(),i._update(),e.done()&&(i._cancelAnimation("constraintAnimation"),i._motionState.constraintAnimationConstraint=null,i._update())}))}var e=this.createMotion(this._variable.valueOf(),t);e.done()||(this._cancelAnimation("velocityAnimation"),this._cancelAnimation("constraintAnimation"),this._motionState.velocityAnimation=Gravitas.createAnimation(e,function(){i._motionState.velocityAnimationPosition=e.x(),i._motionState.velocityAnimationVelocity=e.dx(),i._update(),e.done()&&(i._cancelAnimation("velocityAnimation"),i._update(),i._hitConstraint&&i._createAnimation(0))}))}},i.prototype.hitConstraint=function(t,i){return t!=this._hitConstraint?(this._hitConstraint=t,this._constraintCoefficient=i,this._motionState.dragging?void this._update():void(this._motionState.trialAnimation||this._createAnimation())):void 0},i.prototype.hitConstraints=function(t){return 0==t.length?(this._hitConstraint=null,void(this._constraintCoefficient=1)):(t.sort(function(t,i){var n=t.motionConstraint,e=i.motionConstraint;return n.overdragCoefficient==e.overdragCoefficient?Math.abs(i.delta)-Math.abs(t.delta):e.overdragCoefficient-n.overdragCoefficient}),void this.hitConstraint(t[0].motionConstraint,t[0].coefficient,t[0].delta))},i.prototype.animating=function(){return this._motionState.dragging?!1:!!this._motionState.velocityAnimation||this._motionState.trialAnimation},i.prototype.editing=function(){return this._motionState.editing},i.prototype.cancelAnimations=function(){this._cancelAnimation("velocityAnimation"),this._cancelAnimation("constraintAnimation"),this._hitConstraint=null,this._update()},t.exports=i},function(t){"use strict";function i(t,i,e,o){if(this.variable=t,this.value=e,"string"==typeof i)switch(i){case"==":this.op=n.equal;break;case">=":this.op=n.greater;break;case"<=":this.op=n.less;break;case"<":this.op=n.l;break;case">":this.op=n.g;break;case"%":this.op=n.modulo;break;case"||":this.op=n.or}else this.op=i;o||(o={}),this.overdragCoefficient=o.hasOwnProperty("overdragCoefficient")?o.overdragCoefficient:.75,this.physicsModel=o.physicsModel,this.captive=o.captive||!1}var n={greater:function(t,i){return t>=i?0:i-t},less:function(t,i){return i>=t?0:i-t},l:function(t,i){return i>t?0:i-t},g:function(t,i){return t>i?0:i-t},equal:function(t,i){return i-t},modulo:function(t,i,n){var e=i*Math.round(n/i);return e-t},adjacentModulo:function(t,i,e,o){if(void 0===o)return n.modulo(t,i,e);var a=Math.round(o/i),s=Math.round(e/i),r=s-a;r&&(r/=Math.abs(r));var h=(a+r)*i;return h-t},or:function(t,i,n){var e=9007199254740991;if(!Array.isArray(i))return 0;for(var o=e,a=n,s=0;s<i.length;s++){var r=Math.abs(i[s]-n);r>o||(o=r,a=i[s])}return a-t}};i.underDamped=function(){return new Gravitas.Spring(1,200,20)},i.criticallyDamped=function(){return new Gravitas.Spring(1,200,Math.sqrt(800))},i.ops=n,i.prototype.delta=function(t,i){return t||(t=this.variable),this.op(this.variable,this.value,t,i)},i.prototype.createMotion=function(t){var i=this.physicsModel?this.physicsModel():new Gravitas.Spring(1,200,20);return i.snap(t),i},t.exports=i},function(t,i,n){"use strict";function e(){this._solver=new o(new c.SimplexSolver),this._boxes=[],this._motionConstraints=[],this._manipulators=[],this._updating=!1}var o=n(5);e.prototype.solver=function(){return this._solver},e.prototype.addBox=function(t){this._boxes.push(t)},e.prototype.boxes=function(){return this._boxes},e.prototype.addMotionConstraint=function(t){return this._motionConstraints.push(t),t},e.prototype.addManipulator=function(t){return this._manipulators.push(t),t._setMotionContext(this),this.update(),t},e.prototype.update=function(){if(!this._updating){this._updating=!0,this._resolveMotionConstraints();for(var t=0;t<this._boxes.length;t++)this._boxes[t].update();this._updating=!1}},e.prototype._coefficient=function(t,i){var n=this._solver.solver(),e=t.variable(),o=n._editVarMap.get(e);if(!o)return 0;var a=o.editMinus,s=n.rows.get(i);return s?s.coefficientFor(a):0},e.prototype._resolveMotionConstraints=function(){function t(t,i,e,o){var a={motionConstraint:i,coefficient:e,delta:o},s=t.name();n.hasOwnProperty(s)?n[s].violations.push(a):n[s]={manipulator:t,violations:[a]}}function i(){for(var t in n){var i=n[t];i.manipulator.hitConstraints(i.violations)}}for(var n={},e=0;e<this._manipulators.length;e++){var o=this._manipulators[e];n[o.name()]={manipulator:o,violations:[]}}for(var e=0;e<this._motionConstraints.length;e++){var a=this._motionConstraints[e],s=a.delta();if(0!=s)for(var r=0;r<this._manipulators.length;r++){var o=this._manipulators[r];if(0!=s){var h=this._coefficient(o,a.variable);0!=h&&t(o,a,h,s)}}}i()},e.prototype.stopOthers=function(t){for(var i=0;i<this._manipulators.length;i++){var n=this._manipulators[i];0!=this._coefficient(n,t)&&n.cancelAnimations()}},t.exports=e},function(t){"use strict";function i(t){this._solver=t,this._editing=!1,this._editVars=[],this._priority=0,this.add=this._solver.add.bind(this._solver),this.solve=this._solver.solve.bind(this._solver),this.resolve=this._solver.resolve.bind(this._solver),this.addConstraint=this._solver.addConstraint.bind(this._solver),this.removeConstraint=this._solver.removeConstraint.bind(this._solver)}i.prototype.solver=function(){return this._solver},i.prototype.beginEdit=function(t,i){var n=this._find(t);return-1!=n?(this._editVars[n].count++,void console.log("multiple edit sessions on "+t.name)):(this._editVars.push({edit:t,strength:i,priority:this._priority++,suggest:null,count:1}),void this._reedit())},i.prototype._find=function(t){for(var i=0;i<this._editVars.length;i++)if(this._editVars[i].edit===t)return i;return-1},i.prototype.endEdit=function(t){var i=this._find(t);return-1==i?void console.warn("cannot end edit on variable that is not being edited"):(this._editVars[i].count--,void(0==this._editVars[i].count&&(this._editVars.splice(i,1),this._reedit())))},i.prototype.suggestValue=function(t,i){if(!this._editing)return void console.warn("cannot suggest value when not editing");var n=this._find(t);return-1==n?void console.warn("cannot suggest value for variable that we are not editing"):(this._editVars[n].suggest=i,void this._solver.suggestValue(t,i).resolve())},i.prototype._reedit=function(){if(this._editing&&(this._solver.endEdit(),this._solver.removeAllEditVars()),this._editing=!1,0==this._editVars.length)return void this._solver.resolve();for(var t=0;t<this._editVars.length;t++){var i=this._editVars[t];this._solver.addEditVar(i.edit,i.strength,i.priority)}this._solver.beginEdit();for(var t=0;t<this._editVars.length;t++){var i=this._editVars[t];i.suggest&&this._solver.suggestValue(i.edit,i.suggest)}this._solver.resolve(),this._editing=!0},t.exports=i},function(t,i,n){"use strict";function e(t){function i(t,n){if(Array.isArray(t))for(var e=0;e<t.length;e++)i(t[e],n);else{var o=new a(t.textContent?t.textContent:"");n.addChild(o),n.element().appendChild(o.element()),d[t.id]=o,o.element().id=t.id,t.className&&(o.element().className=t.className),t.children&&i(t.children,o)}}function n(t){function i(t,i){return t.hasOwnProperty(i)&&t[i].isExternal?t[i]:(t[i]=new c.Variable({name:i}),t[i])}if(v.hasOwnProperty(t))return v[t];if(-1==t.indexOf("_"))return v[t]=new c.Variable({name:t}),v[t];var n=t.split("_",2);if(n.length<2||!d.hasOwnProperty(n[0]))return null;var e=d[n[0]];switch(n[1]){case"left":return i(e,"x");case"right":return i(e,"right");case"top":return i(e,"y");case"bottom":return i(e,"bottom")}return null}function e(t){switch(t.type){case"Inequality":var i="<="==t.operator?c.LEQ:c.GEQ,o=new c.Inequality(e(t.left),i,e(t.right),weak);return _.addConstraint(o),o;case"Equality":var o=new c.Equation(e(t.left),e(t.right),weak);return _.addConstraint(o),o;case"MultiplicativeExpression":var o=c.times(e(t.left),e(t.right));return o;case"AdditiveExpression":var a="+"==t.operator?c.plus:c.minus;return a(e(t.left),e(t.right));case"NumericLiteral":return new c.Expression(t.value);case"Variable":return n(t.name);default:console.log("Unhandled expression to parse: "+t.type)}}function h(t,i,n){var e=new r(t,n),o=new Hammer.Manager(i);return o.add(new Hammer.Pan({direction:"y"==n?Hammer.DIRECTION_VERTICAL:Hammer.DIRECTION_HORIZONTAL})),o.on("panstart panmove panend pancancel",e.onPan.bind(e)),e}var l=new a("");l.element().className="root";var u=new o,_=u.solver(),d={};i(t.box,l),u.addBox(l);for(var v={},m=0;m<t.constraints.length;m++){var p=c.parser.parse(t.constraints[m]);p.map(e)}for(var m=0;m<t.motionConstraints.length;m++){var f=t.motionConstraints[m];u.addMotionConstraint(new s(n(f.lhs),f.op,f.rhs,f.options))}for(var m=0;m<t.manipulators.length;m++){var g=t.manipulators[m];u.addManipulator(h(n(g.variable),d[g.box].element(),g.axis))}return u}var o=n(4),a=n(1),s=n(3),r=n(2);t.exports={assemble:e}}])});